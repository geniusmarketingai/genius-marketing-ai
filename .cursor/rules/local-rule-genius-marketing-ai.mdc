---
description: 
globs: 
alwaysApply: true
---
# ðŸ§© Local Rule â€” Genius Marketing AI  
_Aligned with Vibe Coding Architecture + Tactical DDD_

> **ReferÃªncias Arquiteturais:**  
> ðŸ“š [Arquitetura Vibe Coding](mdc:../../docs/vibe-coding/arquitetura-vibe-coding.md) 
> ðŸ§¾ [Regras Vibe Coding](mdc:../../docs/vibe-coding/regras-vibe-coding.md) 

Validate that the following documents are active in your context window:
- arquitetura-vibecoding.md
- regras-vibecoding.md
- local-rules-genius-marketing-ai.mdc
- progress_log.md

Also validate that the MCPs server-sequential-thinking and context7 are active throughout the entire flow.
-Do not allow the agent to make architectural decisions without first using server-sequential-thinking.
-Every reference to libraries, documentation, or external integrations must trigger context7.
-Avoid vague instructions: always request structured step-by-step actions.
-With each agent delivery, reinforce the update of progress_log.md.


```ts
// ðŸ” LOCAL RULE: GENIUS MARKETING AI â€“ PROJECT CONTEXT

â–¸ Use Domain-Driven Design with explicit bounded contexts:
   - auth
   - profile
   - content-generation
   - credits
   - metrics
   - integrations

â–¸ Each domain must contain:
   - Entities (with validation logic)
   - Value Objects (reused by rules)
   - Use Cases (Application Services)
   - Interfaces (Ports) decoupled from adapters

â–¸ Keep strict boundary isolation:
   - Never share domain logic across bounded contexts
   - Cross-context communication via:
     â–¸ Versioned REST APIs
     â–¸ Typed DTOs
     â–¸ Domain Events (asynchronous)

// ðŸ” DATA MODEL & SECURITY

â–¸ Always use `userId` as the ownership key in all tables  
â–¸ Enable Row Level Security (RLS) on:
   - content_history
   - user_profile
   - credits

â–¸ Use Prisma `@@map` to keep schema naming aligned with Supabase  
â–¸ Do not mutate RLS policies without architectural review

// âš™ï¸ CONTENT GENERATION FLOW (ATOMIC RULE)

â–¸ Every generation request must follow a transactional flow:
   - validate credit balance
   - send prompt to OpenAI
   - save content to DB
   - deduct 1 credit
   - return result

â–¸ If any step fails, rollback the entire operation

// ðŸ§ª TESTING REQUIREMENTS

â–¸ Enforce layered test coverage:
   - Domain Layer â†’ 100% unit test
   - Application Layer â†’ integration test per use case
   - API Layer â†’ E2E (Cypress/Postman) for core flows

â–¸ Every PR must include:
   - Corresponding test(s)
   - Test for invalid/edge case
   - CI pass before merge

// ðŸ“ CONTRACTS & SCHEMA VERSIONING

â–¸ For every exposed service or integration:
   - Define DTOs or input/output schemas
   - Version public APIs (/v1/...)
   - Validate all inputs at boundary level
   - Document via OpenAPI or JSON Schema

â–¸ Backwards compatibility must be guaranteed unless explicitly versioned

// ðŸ§  BRAZILIAN CONTEXT AWARENESS (AI PROMPTS)

â–¸ All AI-generated content must:
   - Be written in Brazilian Portuguese
   - Match the tone and style of each persona/niche
   - Include regional idioms, slang, and expressions

â–¸ Prompt templates must be reusable and testable via content unit tests

// ðŸ–¥ï¸ FRONTEND UX RULES (WIREFRAME-BOUND)

â–¸ Follow approved wireframes strictly:
   - Mobile-first (Tailwind `w-full`, stacked layouts)
   - Fixed action buttons on mobile
   - Accessible components (keyboard nav, contrast, labels)

â–¸ No UI or UX flow should deviate without UX lead or stakeholder validation

// ðŸ§¼ CODE & PROJECT HYGIENE

â–¸ Never introduce external libraries or services without architectural validation  
â–¸ If new tech replaces old, the legacy implementation must be removed

â–¸ All relevant decisions, migrations, or architecture changes:
   - Must be logged in `progress_log.md`
   - Include justification, impact scope, and proposed rollback

â–¸ Refactor anything > 300 lines or violating SRP

// âœ… GOAL



























This rule guarantees domain cohesion, cultural alignment, architectural stability, and system scalability â€” in the spirit of Vibe Coding.